(()=>{"use strict";const t=250;class s{constructor(t,s,i){this.t=t,this.i=s,this.color=i,this.h=[],this.o()}o(){const{t,i:s,color:e}=this,h=Math.atan2(s.y-t.y,s.x-t.x),o=Math.hypot(s.x-t.x,s.y-t.y);for(let s=0;s<Math.ceil(o/n);s++){const o=t.x+Math.cos(h)*s*n,c=t.y+Math.sin(h)*s*n;this.h.push(new i(o,c,e,h))}this.angle=h}reset(){this.h=[],this.o()}update(){for(let t=0;t<this.h.length;t++)this.h[t].l<=0||this.h[t].update()}draw(t){for(let s=0;s<this.h.length;s++)this.h[s].l<=0||this.h[s].draw(t)}}class i{constructor(t,s,i,n){this.color=i,this.u={x:t,y:s},this.M={x:0,y:0},this.color=i,this.l=100,this.angle=n}update(){this.u.x+=this.M.x,this.u.y+=this.M.y,this.l--}draw(t){this.left<0||(this.l<75?t.fillStyle=`rgba(${this.color}, ${this.l/75})`:t.fillStyle=`rgba(${this.color}, 1)`,t.beginPath(),t.rect(this.u.x-n/2,this.u.y,n,n),t.fill(),t.closePath())}}const n=20,e="255,255,255";class h{constructor(t,s,i,h,o=!0,c=!0){this.width=n,this.u={x:0,y:0},this.t={x:0,y:0},this.i={x:0,y:0},this.p={x:0,y:0},this.m={x:0,y:0},this.v=!1,this.j=o,this.$=c,this.color=o?e:"0,0,0",this.k(t,s,i,h)}k(t,s,i,n){this.t.x=t,this.t.y=s,this.i.x=i,this.i.y=n;const{t:e,i:h}=this;this.u.x=(e.x+h.x)/2,this.u.y=(e.y+h.y)/2,this.angle=Math.atan2(h.y-e.y,h.x-e.x)-Math.PI/2,this.C=this.P(e,h,this.width),this.F=this.I();const o=6*Math.sin(this.angle),c=6*-Math.cos(this.angle);this.p.x=this.t.x-o,this.p.y=this.t.y-c,this.m.x=this.i.x+o,this.m.y=this.i.y+c,this.A()}update(){this.v&&this.B.update()}A(){this.B=new s(this.t,this.i,this.color)}reset(){this.v=!1,this.B.reset()}N(t){this.v=!0,this.B.h.forEach((s=>{const i=Math.random()*Math.PI*2;s.M.x=t*(2*Math.random()-1)*Math.cos(i),s.M.y=t*(2*Math.random()-1)*Math.sin(i)}))}P(t,s,i){const n=i/2,e=Math.sqrt((s.x-t.x)**2+(s.y-t.y)**2)/2,h=this.angle;return[{x:-n,y:-e},{x:-n,y:e},{x:n,y:e},{x:n,y:-e}].map((t=>({x:this.u.x+(t.x*Math.cos(h)-t.y*Math.sin(h)),y:this.u.y+(t.x*Math.sin(h)+t.y*Math.cos(h))})))}I(){const t=[],s=this.C,i=s.length;for(let n=0;n<i;n++){const e=(n+1)%i,h=s[e].x-s[n].x,o=s[e].y-s[n].y,c=Math.sqrt(h*h+o*o),a={x:-o/c,y:h/c};t.push(a)}return t}D(t){let s=Number.POSITIVE_INFINITY,i=-Number.POSITIVE_INFINITY;for(let n=0;n<this.C.length;n++){let e=this.C[n].x*t.x+this.C[n].y*t.y;s=Math.min(s,e),i=Math.max(i,e)}return{min:s,max:i}}H(t,s,i,n,e){const h=t-i,o=s-n;return h*h+o*o<=e*e}J(t,s){return this.T(t,s)}T(t,s){let i=!1;const n=this.C,e=n.length;for(let h=0,o=e-1;h<e;o=h++){const e=n[h].x,c=n[h].y,a=n[o].x,r=n[o].y;c>s!=r>s&&t<(a-e)*(s-c)/(r-c)+e&&(i=!i)}return i}V(t,s){return this.W(t,s)?this.t:this.L(t,s)?this.i:null}W(t,s){return this.H(t,s,this.p.x,this.p.y,15)}L(t,s){return this.H(t,s,this.m.x,this.m.y,15)}O(t,s){return this.j?this.H(t,s,this.u.x,this.u.y,15):null}draw(t){this.v?this.B.draw(t):this.$?this.q(t):this.R(t)}q(t){t.beginPath(),t.setLineDash([]),t.fillStyle=`rgba(${this.color}, 1.0)`,t.strokeStyle="#000",t.lineWidth=2,t.moveTo(this.C[0].x,this.C[0].y);for(let s=1;s<this.C.length;s++)t.lineTo(this.C[s].x,this.C[s].y);t.closePath(),t.fill(),t.stroke(),this.color===e&&(t.beginPath(),t.lineWidth=2,t.strokeStyle="red",t.moveTo(this.u.x-5,this.u.y-5),t.lineTo(this.u.x+5,this.u.y+5),t.moveTo(this.u.x-5,this.u.y+5),t.lineTo(this.u.x+5,this.u.y-5),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="rgba(255, 0, 0, 1.0)",t.arc(this.p.x,this.p.y,4,0,2*Math.PI),t.arc(this.m.x,this.m.y,4,0,2*Math.PI),t.fill())}R(t){t.beginPath(),t.fillStyle=`rgba(${this.color}, 0.60)`,t.strokeStyle="#000",t.lineWidth=2,t.moveTo(this.C[0].x,this.C[0].y);for(let s=1;s<this.C.length;s++)t.lineTo(this.C[s].x,this.C[s].y);t.closePath(),t.setLineDash([5,5]),t.stroke(),t.fill(),this.color===e&&(t.beginPath(),t.lineWidth=2,t.strokeStyle="red",t.setLineDash([]),t.moveTo(this.u.x-5,this.u.y-5),t.lineTo(this.u.x+5,this.u.y+5),t.moveTo(this.u.x-5,this.u.y+5),t.lineTo(this.u.x+5,this.u.y-5),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="rgba(255, 0, 0, 1.0)",t.arc(this.p.x,this.p.y,4,0,2*Math.PI),t.arc(this.m.x,this.m.y,4,0,2*Math.PI),t.fill()),t.setLineDash([])}}class o{constructor(t=0,s=0,i=0,n=1){this.S={x:t,y:s},this.angle=i,this.U=n,this.G={x:t,y:s}}get K(){return this.G.x=this.S.x+this.U*Math.cos(this.angle),this.G.y=this.S.y+this.U*Math.sin(this.angle),this.G}}class c{constructor(){this.C=[]}}function a(t,s){return t.max>s.min&&s.max>t.min}function r(t,s){return Math.min(t.max-s.min,s.max-t.min)}function l(t,s){let i=Number.POSITIVE_INFINITY,n=null,e=null;for(let h=0;h<s.F.length;h++){const o=s.F[h],c=s.D(o),l=t.D(o);if(!a(c,l))return null;{const t=r(c,l);t<i&&(i=t,n=o,e=s.C[h])}}for(const h of s.C){const o={x:t.u.x-h.x,y:t.u.y-h.y},c=Math.sqrt(o.x*o.x+o.y*o.y);if(0===c)continue;o.x/=c,o.y/=c;const l=s.D(o),u=t.D(o);if(!a(l,u))return null;{const t=r(l,u);t<i&&(i=t,n=o,e=h)}}if(i===Number.POSITIVE_INFINITY)return null;let h=t.u.x-e.x,o=t.u.y-e.y;return h*n.x+o*n.y<0&&(n.x=-n.x,n.y=-n.y),{X:{x:n.x*i,y:n.y*i},axis:n}}class u{Y=[];Z=[];_=[];tt=[];st=!1;backgroundColor="#557ad9";it="red";nt="red";et="red";ht="red";ot="#ffffff";width=500;height=500;ct=!1;reset(){this.ct=!1,this.st=!1,this.Y.forEach((t=>{t.reset()})),this.Z.forEach((t=>{t.reset()})),document.getElementById("js-place-wall").classList.remove("disabled"),document.getElementById("js-place-wall").setAttribute("disabled",!1),document.body.style.backgroundColor=this.it}get rt(){for(let t=0;t<this.Y.length;t++)if(!this.Y[t].lt)return!1;return!0}}class d{ut=1;constructor(t,s,i=0,n=8){this.dt=n,this.color="#fff",this.u={x:t,y:s},this.ft={x:t,y:s},this.M={x:0,y:0},this.lt=null,this.ut=n,this.wt=i,this.u.x=t,this.u.y=s,this.alpha=1,this.Mt=!1,this.bt=0}D(t){const s=this.u.x*t.x+this.u.y*t.y;return{min:s-this.dt,max:s+this.dt}}update(){const t=.98-this.bt;this.M.x*=t,this.M.y*=t,Math.abs(this.M.x)<.01&&(this.M.x=0),Math.abs(this.M.y)<.01&&(this.M.y=0),this.u.x+=this.M.x,this.u.y+=this.M.y}reset(){this.u.x=this.ft.x,this.u.y=this.ft.y,this.lt=null,this.M.x=0,this.M.y=0,this.Mt=!1,this.alpha=1}}class f{lt=null;constructor(t,s,i=15,n="black"){this.u={x:t,y:s},this.dt=i,this.color=n}}class w extends u{backgroundColor="#8eb087";constructor(){super(),this._=[new f(400,250)],this.Y=[new d(250,250)]}}class M extends u{backgroundColor="#ffe55e";constructor(){super(),this._=[new f(400,125),new f(400,375)],this.Y=[new d(250,125),new d(250,375)]}}class p extends u{backgroundColor="#ffe55e";constructor(){super(),this._=[new f(100,125),new f(400,375)],this.Y=[new d(250,125),new d(250,375,Math.PI)]}}class m extends u{backgroundColor="#374d93";constructor(){super(),this._=[new f(400,125),new f(400,375)],this.Y=[new d(50,125),new d(250,375,Math.PI)],this.Z=[new h(100,50,100,200,!1)]}}class b extends u{backgroundColor="#374d93";constructor(){super(),this._=[new f(400,125),new f(400,375)],this.Y=[new d(150,125),new d(250,375,Math.PI)],this.Z=[new h(5,0,5,500,!1),new h(495,0,495,500,!1)]}}class x extends u{backgroundColor="#374d93";constructor(){super(),this._=[new f(250,150),new f(100,350),new f(400,350)];const t=[{x:100,y:200},{x:400,y:200},{x:250,y:400}],s=(t[0].x+t[1].x+t[2].x)/3,i=(t[0].y+t[1].y+t[2].y)/3,n=(t,n)=>Math.atan2(i-n,s-t);this.Y=[new d(t[0].x,t[0].y,n(100,200)),new d(t[1].x,t[1].y,n(400,200)),new d(t[2].x,t[2].y,n(250,400))],this.Z=[]}}class v extends u{backgroundColor="#374d93";constructor(){super(),this._=[new f(150,400),new f(250,400),new f(350,400)],this.Y=[new d(150,150),new d(250,200),new d(350,250)],this.Z=[]}}class y extends u{backgroundColor="#374d93";constructor(){super(),this._=[new f(250,250)];this.Y=[new d(400,250,0),new d(250+150*Math.cos(Math.PI),250+150*Math.sin(Math.PI),Math.PI)]}}class j extends u{backgroundColor="#374d93";constructor(){super(),this._=[new f(250,250)],this.Y=[new d(50,250,0),new d(450,250,Math.PI)],this.Z=[new h(200,200,200,300,!1)]}}const g=.25,$=.15,k=document.getElementById("canvas"),C=k.getContext("2d"),P={ct:1,$:2,xt:4,vt:8,yt:16,jt:18,gt:32,$t:22};let E={kt:null,Ct:null,Pt:null,inputMode:P.ct,Et:P.ct};function F(){const t=window.innerWidth/k.width,s=window.innerHeight/k.height;return Math.min(t,s)}E.Ft=document.getElementById("game-ui"),E.title=document.getElementById("title-container"),document.getElementById("js-hit-ball").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(E.inputMode=P.ct,t.currentTarget.classList.add("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-place-bump").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 2px ${V.et}`,document.getElementById("js-place-wall").style.boxShadow=`0 5px ${V.et}`,document.getElementById("js-place-bump").style.boxShadow=`0 5px ${V.et}`)})),document.getElementById("js-place-wall").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(E.inputMode=P.$,t.currentTarget.classList.add("active"),document.getElementById("js-hit-ball").classList.remove("active"),document.getElementById("js-place-bump").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 5px ${V.et}`,document.getElementById("js-place-wall").style.boxShadow=`0 2px ${V.et}`,document.getElementById("js-place-bump").style.boxShadow=`0 5px ${V.et}`)})),document.getElementById("js-place-bump").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(E.inputMode=P.yt,t.currentTarget.classList.add("active"),document.getElementById("js-hit-ball").classList.remove("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 5px ${V.et}`,document.getElementById("js-place-wall").style.boxShadow=`0 5px ${V.et}`,document.getElementById("js-place-bump").style.boxShadow=`0 2px ${V.et}`)})),document.getElementById("js-reset").addEventListener("click",(t=>{t.preventDefault(),V.reset(),at()}));const I=new h(0,0,0,0,!0,!0),A=[new w,new M,new p,new m,new b,new x,new v,new y,new j],B=[.5,.5,.5],N=[.5,.5,.5],D=[2,1,0],H=[.5,.2,.25];for(let t=0;t<A.length;t++){const s=t/A.length,i=(t+1)/A.length,n=(t+2)/A.length;A[t].backgroundColor=wt(s,B,N,D,H),A[t].it=wt(i,B,N,D,H);const e=wt(n,B,N,D,H),h=wt(n,B,N,D,H).slice(5).split(",").map(((t,s)=>3===s?1:Math.max(parseFloat(t)/2,0))).join(","),o=wt(n,B,N,D,H).slice(5).split(",").map(((t,s)=>3===s?.5:Math.max(parseFloat(t)/2,0))).join(",");A[t].nt=e,A[t].et=`rgba(${h})`,A[t].ot=pt(...Mt(e)),A[t].ht=`rgba(${o})`}let J=0,T=(J+1)%A.length,V=A[J];V.reset();let W=A[T];const z=[],L=Math.hypot(k.width,k.height)/2;let O=L;const q=5,Q=new class{constructor(t,s,i,n){this.canvas=t,this.It=s,this.At=i,this.Bt=n,this.Nt={x:0,y:0},this.Dt={x:0,y:0},this.Ht={x:0,y:0},this.Jt={x:0,y:0},this.pressed=!1,this.boundingRect=this.canvas.getBoundingClientRect(),this.Tt(this.canvas)}resize(){this.boundingRect=this.canvas.getBoundingClientRect()}Tt(t){t.addEventListener("mousedown",this.Vt.bind(this),{capture:!0,passive:!1}),window.addEventListener("mousemove",this.Wt.bind(this),{capture:!0,passive:!1}),window.addEventListener("mouseup",this.zt.bind(this),{capture:!0,passive:!1}),t.addEventListener("touchstart",this.Lt.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchend",this.zt.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchmove",this.Ot.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchcancel",this.zt.bind(this),{capture:!0,passive:!1})}qt(){this.Ht.x=(this.Dt.x-this.Nt.x)/t,this.Ht.y=(this.Nt.y-this.Dt.y)/t}Qt(t){const s=canvas.getBoundingClientRect();let i,n;if(t instanceof MouseEvent)i=t.clientX-s.left,n=t.clientY-s.top;else if(t instanceof TouchEvent){const t=event.touches[0];i=t.clientX-s.left,n=t.clientY-s.top}i*=canvas.width/s.width,n*=canvas.height/s.height,this.Jt.x=i,this.Jt.y=n}Rt(t){let s=0;return t instanceof MouseEvent?s=t.clientX:t instanceof TouchEvent&&(s=t.changedTouches[0].clientX),(s-this.boundingRect.left)*(this.canvas.width/this.boundingRect.width)}St(t){let s=0;return t instanceof MouseEvent?s=t.clientY:t instanceof TouchEvent&&(s=t.changedTouches[0].clientY),(s-this.boundingRect.top)*(this.canvas.height/this.boundingRect.height)}Lt(t){t.preventDefault(),this.Qt(t),this.Ut(this.Rt(t),this.St(t))}Ot(t){t.preventDefault(),this.Qt(t),this.Gt(this.Rt(t),this.St(t)),console.log(this.pressed)}Vt(t){t.preventDefault(),this.Qt(t),this.Ut(this.Rt(t),this.St(t))}Wt(t){t.preventDefault(),this.Qt(t),this.Gt(this.Rt(t),this.St(t))}Ut(t,s){this.pressed=!0,this.Nt.x=t,this.Nt.y=s,this.Dt.x=t,this.Dt.y=s,this.qt(),this.It()}Gt(s,i){if(!this.pressed)return;const n=s-this.Nt.x,e=i-this.Nt.y,h=Math.hypot(n,e);if(this.Dt.x=s,this.Dt.y=i,h>t){const s=n/h*t,i=e/h*t;this.Dt.x=this.Nt.x+s,this.Dt.y=this.Nt.y+i}this.qt(),this.Bt()}zt(t){0!=this.pressed&&(t.preventDefault(),t.stopPropagation(),this.pressed=!1,this.Nt.x=0,this.Nt.y=0,this.Dt.x=0,this.Dt.y=0,this.qt(),this.At())}draw(t){this.pressed&&(this.Kt(t),this.Xt(t))}Kt(s){s.strokeStyle="#FFD700",s.lineWidth=6,s.beginPath(),s.arc(this.Nt.x,this.Nt.y,t,0,2*Math.PI),s.stroke(),s.closePath()}Xt(t){t.strokeStyle="#F0E68C",t.lineWidth=6,t.beginPath(),t.arc(this.Dt.x,this.Dt.y,125,0,2*Math.PI),t.fillStyle="#F0E68C",t.globalAlpha=.5,t.fill(),t.globalAlpha=1,t.closePath()}}(k,(function(){E.title.style.opacity=0;for(let t=0;t<V.Z.length;t++){const s=V.Z[t];if(!s.j)continue;const i=s.V(Q.Jt.x,Q.Jt.y);if(s.O(Q.Jt.x,Q.Jt.y))return void V.Z.splice(t,1);if(i)return E.Et=E.inputMode,E.inputMode=P.xt,E.Ct=s,void(E.Pt=i);s.J(Q.Jt.x,Q.Jt.y)&&(E.Et=E.inputMode,E.inputMode=P.vt,E.Ct=s,E.Pt=null)}for(let t=0;t<V.tt.length;t++){const s=V.tt[t];if(!s.j)continue;const i=s.V(Q.Jt.x,Q.Jt.y);if(s.O(Q.Jt.x,Q.Jt.y))return void V.tt.splice(t,1);if(i)return E.Et=E.inputMode,E.inputMode=P.xt,E.Ct=s,void(E.Pt=i);s.J(Q.Jt.x,Q.Jt.y)&&(E.Et=E.inputMode,E.inputMode=P.vt,E.Ct=s,E.Pt=null)}E.inputMode===P.ct?function(){z.length=0;for(let t=0;t<V.Y.length;t++){const s=V.Y[t];z.push(new o(s.u.x,s.u.y,Q.Ht.x,Q.Ht.y))}}():E.inputMode&P.jt&&R.C.push({x:Q.Jt.x,y:Q.Jt.y})}),(function(){E.inputMode===P.ct?function(){if(0===z.length)return;for(let t=0;t<V.Y.length;t++){const s=V.Y[t];if(s.lt)continue;const i=z[t],n=Math.cos(i.angle)*i.U*.05,e=Math.sin(i.angle)*i.U*.05;s.M.x=n,s.M.y=e}z.length=0,V.ct=!0,E.inputMode=P.gt,k.style.cursor="not-allowed",document.getElementById("js-hit-ball").classList.add("disabled"),document.getElementById("js-place-wall").classList.add("disabled"),document.getElementById("js-place-bump").classList.add("disabled");const t=document.getElementById("js-reset");t.classList.remove("disabled"),Array.from(document.getElementsByClassName("button")).forEach((t=>{"js-reset"!==t.id&&(t.style.backgroundColor=null,t.style.boxShadow=null)})),t.style.backgroundColor=V.nt,t.style.boxShadow=`0 5px ${V.et}`,t.style.color=V.ot}():E.inputMode&P.jt?function(){if(R.C.length<2)return;E.inputMode===P.$?V.Z.push(new h(R.C[0].x,R.C[0].y,R.C[1].x,R.C[1].y,!0)):E.inputMode===P.yt&&V.tt.push(new h(R.C[0].x,R.C[0].y,R.C[1].x,R.C[1].y,!0,!1));R=new c}():(E.inputMode===P.xt||E.inputMode===P.vt)&&(E.inputMode=E.Et,E.Ct=null,E.Pt=null);E.Ft.style.backgroundColor=null}),(function(){E.inputMode===P.ct?function(){let t=1;for(let s=0;s<z.length;s++){const i=z[s],n=V.Y[s];if(n.lt)continue;t=n.wt;const e=t+S(Q),h=Y(Q.Dt.x,Q.Dt.y,Q.Nt.x,Q.Nt.y);i.angle=e,i.U=h}}():E.inputMode&P.jt&&Q.pressed?(R.C[R.C.length-1].x=Q.Jt.x,R.C[R.C.length-1].y=Q.Jt.y):E.inputMode===P.xt?E.Pt&&(E.Pt===E.Ct.t?E.Ct.k(Q.Jt.x,Q.Jt.y,E.Ct.i.x,E.Ct.i.y):E.Ct.k(E.Ct.t.x,E.Ct.t.y,Q.Jt.x,Q.Jt.y)):E.inputMode===P.vt&&function(){if(E.Ct){const t=Q.Jt.x-E.Ct.u.x,s=Q.Jt.y-E.Ct.u.y;E.Ct.k(E.Ct.t.x+t,E.Ct.t.y+s,E.Ct.i.x+t,E.Ct.i.y+s)}}()}));let R=new c;function S(t){return Math.atan2(-(t.Dt.y-t.Nt.y),-(t.Dt.x-t.Nt.x))}function U(t){t.u.x+t.dt<0&&(t.u.x=k.width-t.dt),t.u.x-t.dt>k.width&&(t.u.x=t.dt),t.u.y+t.dt<0&&(t.u.y=k.height-t.dt),t.u.y-t.dt>k.height&&(t.u.y=t.dt)}function G(t,s){const i=t.u.x-s.u.x,n=t.u.y-s.u.y;return Math.sqrt(i*i+n*n)<t.dt+s.dt}function K(t,s){const i=t.u.x-s.u.x,n=t.u.y-s.u.y,e=Math.sqrt(i*i+n*n);if(e>t.dt+s.dt)return 0;const h=t.dt+s.dt;return(h-e)/h}function X(t,s){const i=s.u.x-t.u.x,n=s.u.y-t.u.y,e=Math.sqrt(i*i+n*n);if(0===e)return;const h=t.dt+s.dt-e,o=i/e,c=n/e;h>0&&(t.u.x-=h*o*(s.ut/(t.ut+s.ut)),t.u.y-=h*c*(s.ut/(t.ut+s.ut)),s.u.x+=h*o*(t.ut/(t.ut+s.ut)),s.u.y+=h*c*(t.ut/(t.ut+s.ut)));const a=(s.M.x-t.M.x)*o+(s.M.y-t.M.y)*c;if(a>0)return;const r=-2*a/(1/t.ut+1/s.ut);t.M.x-=r/t.ut*o,t.M.y-=r/t.ut*c,s.M.x+=r/s.ut*o,s.M.y+=r/s.ut*c}function Y(t,s,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-s,2))}function Z(t){t.u.x-t.dt<0&&_(t,t.u.x+k.width,t.u.y),t.u.x+t.dt>k.width&&_(t,t.u.x-k.width,t.u.y),t.u.y-t.dt<0&&_(t,t.u.x,t.u.y+k.height),t.u.y+t.dt>k.height&&_(t,t.u.x,t.u.y-k.height),_(t,t.u.x,t.u.y)}function _(t,s,i){C.beginPath(),C.arc(s,i,t.dt,0,2*Math.PI),C.fillStyle=`rgba(255, 255, 255, ${t.alpha})`,C.strokeStyle=`rgba(0, 0, 0, ${t.alpha})`,C.lineWidth=5,C.setLineDash([]),C.closePath(),C.stroke(),C.fill()}function tt(t){C.beginPath(),C.arc(t.u.x,t.u.y,t.dt,0,2*Math.PI),C.fillStyle=t.color,C.fill(),C.closePath()}function st(t){C.fillStyle=t.backgroundColor,C.fillRect(0,0,k.width,k.height);for(let s=0;s<t._.length;s++){tt(t._[s])}for(let s=0;s<t.Z.length;s++){t.Z[s].draw(C)}for(let s=0;s<t.tt.length;s++){t.tt[s].draw(C)}E.inputMode&P.jt&&R.C.length>0&&(I.k(R.C[0].x,R.C[0].y,Q.Jt.x,Q.Jt.y),I.$=E.inputMode===P.$,I.draw(C));for(let s=0;s<t.Y.length;s++){Z(t.Y[s])}}function it(){C.clearRect(0,0,k.width,k.height),V.rt&&(st(W),C.save(),C.beginPath(),C.arc(k.width/2,k.height/2,O,0,2*Math.PI),C.closePath(),C.clip()),st(V),V.rt&&C.restore();for(let t=0;t<z.length;t++){const s=z[t];V.Y[t].lt||nt(C,s.S.x,s.S.y,s.K.x,s.K.y)}if(C.fillStyle="white",C.font="30px Arial",E.Ft.innerText="",E.inputMode&P.$t){let t;if(E.inputMode&P.xt?t=E.Ct:E.inputMode&P.jt&&(t=R),t&&t.C.length>0){if(1===t.C.length){const s=Q.Jt.x-t.C[0].x,i=Q.Jt.y-t.C[0].y,n=180*Math.atan2(i,s)/Math.PI;E.Ft.innerText=`${n.toFixed(0)}`,-0===n&&(E.Ft.innerText="0")}else{const s=t.C[1].x-t.C[0].x,i=t.C[1].y-t.C[0].y,n=180*Math.atan2(i,s)/Math.PI;E.Ft.innerText=`${n.toFixed(0)}`,-0===n&&(E.Ft.innerText="0")}E.Ft.style.color=pt(...Mt(V.backgroundColor)),E.Ft.style.backgroundColor=V.ht}else E.Ft.style.backgroundColor=null}}function nt(t,s,i,n,e){const h=Y(s,i,n,e);var o=Math.min(h,20),c=Math.atan2(e-i,n-s);t.fillStyle="#fff",t.strokeStyle="#000",t.lineWidth=5,t.beginPath(),t.moveTo(s,i),t.lineTo(n-o/2*Math.cos(c),e-o/2*Math.sin(c)),t.stroke(),t.strokeStyle="#fff",t.fillStyle="#fff",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(n,e),t.lineTo(n-o*Math.cos(c-Math.PI/6),e-o*Math.sin(c-Math.PI/6)),t.lineTo(n-o*Math.cos(c+Math.PI/6),e-o*Math.sin(c+Math.PI/6)),t.closePath(),t.fill(),t.lineWidth=3,t.strokeStyle="#000",t.stroke(),t.fillStyle="#fff",t.fill(),t.beginPath(),t.moveTo(s,i),t.lineTo(n-o/2*Math.cos(c),e-o/2*Math.sin(c)),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.fillStyle="#fff",t.beginPath(),t.arc(s,i,5,0,2*Math.PI),t.fill(),t.closePath()}function et(t){for(let s=0;s<V.Y.length;s++){const i=V.Y[s],n=z[s];i.update(t),i.Mt||V.rt||(i.alpha=1);for(let t=0;t<V.Y.length;t++){if(s===t)continue;const n=V.Y[t];i.lt||n.lt||i.alpha<.5||G(i,n)&&X(i,n)}n&&(n.S.x=i.u.x,n.S.y=i.u.y),E.inputMode===P.gt&&(U(i),rt(i),ht(i),ot(i))}if(V.rt&&(O-=q,O<=0&&ct(J+2)),V.ct)for(let t=0;t<V.Y.length;t++){const s=V.Y[t];s.lt||(null===E.kt&&(E.kt=Date.now()),Y(s.M.x,s.M.y,0,0)<$?null===E.kt&&(E.kt=Date.now()):E.kt=null,null!==E.kt&&Date.now()-E.kt>1e3&&(V.reset(),at()))}for(let t=0;t<V.Z.length;t++){const s=V.Z[t];s.v&&s.update()}}function ht(t){for(let s=0;s<V.Z.length;s++){const i=V.Z[s];if(i.v)continue;const n=l(t,i);if(n){const s=.5*Math.hypot(t.M.x,t.M.y);i.N(s),t.u.x+=n.X.x,t.u.y+=n.X.y;const e=n.axis,h=t.M.x*e.x+t.M.y*e.y;t.M.x-=2*h*e.x,t.M.y-=2*h*e.y}}}function ot(t){t.Yt=1;for(let s=0;s<V.tt.length;s++){const i=l(t,V.tt[s]);t.bt=i?.075:0}}function ct(t){J=(t-1)%A.length;const s=(J+1)%A.length;V=A[J],W=A[s],O=L,V.reset(),at(),location.hash=`#/${J+1}`}function at(){document.getElementById("js-hit-ball").classList.add("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-place-bump").classList.remove("active"),document.getElementById("js-reset").classList.remove("active"),document.getElementById("js-hit-ball").classList.remove("disabled"),document.getElementById("js-place-wall").classList.remove("disabled"),document.getElementById("js-place-bump").classList.remove("disabled");const t=document.getElementById("js-reset");t.classList.add("disabled"),Array.from(document.getElementsByClassName("button")).forEach((t=>{t.style.backgroundColor=V.nt,t.style.boxShadow=`0 5px ${V.et}`,t.style.color=V.ot})),t.style.backgroundColor=null,t.style.boxShadow=null,t.style.color=null,E.kt=null,E.Ct=null,E.Pt=null,E.inputMode=P.ct,k.style.cursor="crosshair"}function rt(t){t.Mt=!1;for(let s=0;s<V._.length;s++){const i=V._[s],n=i.u.x-t.u.x,e=i.u.y-t.u.y,h=Math.sqrt(n*n+e*e),o=Math.sqrt(t.M.x*t.M.x+t.M.y*t.M.y);if(h<=i.dt-t.dt&&o<g)t.lt=i;else if(G(t,i)){const s=.2*K(t,i),o=s*n/h,c=s*e/h;t.M.x+=o,t.M.y+=c,t.alpha-=.01,t.alpha=Math.max(t.alpha,0),t.Mt=!0}}}const lt=1e3/60;let ut=0,dt=0;function ft(){const t=window.location.hash.substring(2);return 0===t.length?1:parseInt(t,10)}function wt(t,s,i,n,e){const h=[0,0,0];for(let o=0;o<3;o++)h[o]=s[o]+i[o]*Math.cos(6.28318*(n[o]*t+e[o]));return`rgba(${255*h[0]}, ${255*h[1]}, ${255*h[2]}, 1.0)`}function Mt(t){return t.slice(5).split(",").map(parseFloat).slice(0,3)}function pt(t,s,i){const n=function(t,s,i){return.299*t+.587*s+.114*i}(t,s,i);return n>128?"black":"white"}!function t(s){const i=s-dt;for(dt=s,ut+=i;ut>=lt;)et(lt),ut-=lt;it(),requestAnimationFrame(t)}(0),document.addEventListener("DOMContentLoaded",(()=>{ct(ft()),document.getElementById("js-hit-ball").click()})),window.addEventListener("hashchange",(()=>{ct(ft())})),window.addEventListener("mousemove",(t=>{const s=k.getBoundingClientRect();let i="crosshair";for(let n=0;n<V.Z.length;n++){let e=t.clientX-s.left,h=t.clientY-s.top;const o=V.Z[n];e/=F(),h/=F(),o.O(e,h)?i="pointer":(o.V(e,h)||o.J(e,h))&&(i="grab")}for(let n=0;n<V.tt.length;n++){let e=t.clientX-s.left,h=t.clientY-s.top;const o=V.tt[n];e/=F(),h/=F(),o.O(e,h)?i="pointer":(o.V(e,h)||o.J(e,h))&&(i="grab")}E.inputMode===P.gt&&(i="not-allowed"),k.style.cursor=i}))})();