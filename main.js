(()=>{"use strict";const t=250;class s{constructor(t,s,i){this.t=t,this.i=s,this.color=i,this.h=[],this.o()}o(){const{t,i:s,color:e}=this,h=Math.atan2(s.y-t.y,s.x-t.x),o=Math.hypot(s.x-t.x,s.y-t.y);for(let s=0;s<Math.ceil(o/n);s++){const o=t.x+Math.cos(h)*s*n,c=t.y+Math.sin(h)*s*n;this.h.push(new i(o,c,e,h))}this.angle=h}reset(){this.h=[],this.o()}update(){for(let t=0;t<this.h.length;t++)this.h[t].l<=0||this.h[t].update()}draw(t){for(let s=0;s<this.h.length;s++)this.h[s].l<=0||this.h[s].draw(t)}}class i{constructor(t,s,i,n){this.color=i,this.u={x:t,y:s},this.M={x:0,y:0},this.color=i,this.l=100,this.angle=n}update(){this.u.x+=this.M.x,this.u.y+=this.M.y,this.l--}draw(t){this.left<0||(this.l<75?t.fillStyle=`rgba(${this.color}, ${this.l/75})`:t.fillStyle=`rgba(${this.color}, 1)`,t.beginPath(),t.rect(this.u.x-n/2,this.u.y,n,n),t.fill(),t.closePath())}}const n=20,e="255,255,255";class h{constructor(t,s,i,h,o=!0,c=!0){this.width=n,this.u={x:0,y:0},this.t={x:0,y:0},this.i={x:0,y:0},this.p={x:0,y:0},this.m={x:0,y:0},this.v=!1,this.j=o,this.$=c,this.color=o?e:"0,0,0",this.k(t,s,i,h)}k(t,s,i,n){this.t.x=t,this.t.y=s,this.i.x=i,this.i.y=n;const{t:e,i:h}=this;this.u.x=(e.x+h.x)/2,this.u.y=(e.y+h.y)/2,this.angle=Math.atan2(h.y-e.y,h.x-e.x)-Math.PI/2,this.C=this.P(e,h,this.width),this.F=this.I();const o=6*Math.sin(this.angle),c=6*-Math.cos(this.angle);this.p.x=this.t.x-o,this.p.y=this.t.y-c,this.m.x=this.i.x+o,this.m.y=this.i.y+c,this.A()}update(){this.v&&this.B.update()}A(){this.B=new s(this.t,this.i,this.color)}reset(){this.v=!1,this.B.reset()}N(t){this.v=!0,this.B.h.forEach((s=>{const i=Math.random()*Math.PI*2;s.M.x=t*(2*Math.random()-1)*Math.cos(i),s.M.y=t*(2*Math.random()-1)*Math.sin(i)}))}P(t,s,i){const n=i/2,e=Math.sqrt((s.x-t.x)**2+(s.y-t.y)**2)/2,h=this.angle;return[{x:-n,y:-e},{x:-n,y:e},{x:n,y:e},{x:n,y:-e}].map((t=>({x:this.u.x+(t.x*Math.cos(h)-t.y*Math.sin(h)),y:this.u.y+(t.x*Math.sin(h)+t.y*Math.cos(h))})))}I(){const t=[],s=this.C,i=s.length;for(let n=0;n<i;n++){const e=(n+1)%i,h=s[e].x-s[n].x,o=s[e].y-s[n].y,c=Math.sqrt(h*h+o*o),a={x:-o/c,y:h/c};t.push(a)}return t}D(t){let s=Number.POSITIVE_INFINITY,i=-Number.POSITIVE_INFINITY;for(let n=0;n<this.C.length;n++){let e=this.C[n].x*t.x+this.C[n].y*t.y;s=Math.min(s,e),i=Math.max(i,e)}return{min:s,max:i}}H(t,s,i,n,e){const h=t-i,o=s-n;return h*h+o*o<=e*e}J(t,s){return this.T(t,s)}T(t,s){let i=!1;const n=this.C,e=n.length;for(let h=0,o=e-1;h<e;o=h++){const e=n[h].x,c=n[h].y,a=n[o].x,r=n[o].y;c>s!=r>s&&t<(a-e)*(s-c)/(r-c)+e&&(i=!i)}return i}V(t,s){return this.W(t,s)?this.t:this.L(t,s)?this.i:null}W(t,s){return this.H(t,s,this.p.x,this.p.y,15)}L(t,s){return this.H(t,s,this.m.x,this.m.y,15)}O(t,s){return this.j?this.H(t,s,this.u.x,this.u.y,15):null}draw(t){this.v?this.B.draw(t):this.$?this.q(t):this.R(t)}q(t){t.beginPath(),t.setLineDash([]),t.fillStyle=`rgba(${this.color}, 1.0)`,t.strokeStyle="#000",t.lineWidth=2,t.moveTo(this.C[0].x,this.C[0].y);for(let s=1;s<this.C.length;s++)t.lineTo(this.C[s].x,this.C[s].y);t.closePath(),t.fill(),t.stroke(),this.color===e&&(t.beginPath(),t.lineWidth=2,t.strokeStyle="red",t.moveTo(this.u.x-5,this.u.y-5),t.lineTo(this.u.x+5,this.u.y+5),t.moveTo(this.u.x-5,this.u.y+5),t.lineTo(this.u.x+5,this.u.y-5),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="rgba(255, 0, 0, 1.0)",t.arc(this.p.x,this.p.y,4,0,2*Math.PI),t.arc(this.m.x,this.m.y,4,0,2*Math.PI),t.fill())}R(t){t.beginPath(),t.fillStyle=`rgba(${this.color}, 0.60)`,t.strokeStyle="#000",t.lineWidth=2,t.moveTo(this.C[0].x,this.C[0].y);for(let s=1;s<this.C.length;s++)t.lineTo(this.C[s].x,this.C[s].y);t.closePath(),t.setLineDash([5,5]),t.stroke(),t.fill(),this.color===e&&(t.beginPath(),t.lineWidth=2,t.strokeStyle="red",t.setLineDash([]),t.moveTo(this.u.x-5,this.u.y-5),t.lineTo(this.u.x+5,this.u.y+5),t.moveTo(this.u.x-5,this.u.y+5),t.lineTo(this.u.x+5,this.u.y-5),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="rgba(255, 0, 0, 1.0)",t.arc(this.p.x,this.p.y,4,0,2*Math.PI),t.arc(this.m.x,this.m.y,4,0,2*Math.PI),t.fill()),t.setLineDash([])}}class o{constructor(t=0,s=0,i=0,n=1){this.S={x:t,y:s},this.angle=i,this.U=n,this.G={x:t,y:s}}get K(){return this.G.x=this.S.x+this.U*Math.cos(this.angle),this.G.y=this.S.y+this.U*Math.sin(this.angle),this.G}}class c{constructor(){this.C=[]}}function a(t,s){return t.max>s.min&&s.max>t.min}function r(t,s){return Math.min(t.max-s.min,s.max-t.min)}function l(t,s){let i=Number.POSITIVE_INFINITY,n=null,e=null;for(let h=0;h<s.F.length;h++){const o=s.F[h],c=s.D(o),l=t.D(o);if(!a(c,l))return null;{const t=r(c,l);t<i&&(i=t,n=o,e=s.C[h])}}for(const h of s.C){const o={x:t.u.x-h.x,y:t.u.y-h.y},c=Math.sqrt(o.x*o.x+o.y*o.y);if(0===c)continue;o.x/=c,o.y/=c;const l=s.D(o),u=t.D(o);if(!a(l,u))return null;{const t=r(l,u);t<i&&(i=t,n=o,e=h)}}if(i===Number.POSITIVE_INFINITY)return null;let h=t.u.x-e.x,o=t.u.y-e.y;return h*n.x+o*n.y<0&&(n.x=-n.x,n.y=-n.y),{X:{x:n.x*i,y:n.y*i},axis:n}}class u{Y=1;constructor(t,s,i=0,n=8){this.Z=n,this.color="#fff",this.u={x:t,y:s},this._={x:t,y:s},this.M={x:0,y:0},this.tt=null,this.Y=n,this.st=i,this.u.x=t,this.u.y=s,this.alpha=1,this.it=!1,this.nt=0}D(t){const s=this.u.x*t.x+this.u.y*t.y;return{min:s-this.Z,max:s+this.Z}}update(){const t=.98-this.nt;this.M.x*=t,this.M.y*=t,Math.abs(this.M.x)<.01&&(this.M.x=0),Math.abs(this.M.y)<.01&&(this.M.y=0),this.u.x+=this.M.x,this.u.y+=this.M.y}reset(){this.u.x=this._.x,this.u.y=this._.y,this.tt=null,this.M.x=0,this.M.y=0,this.it=!1,this.alpha=1}}class d{tt=null;constructor(t,s,i=15,n="black"){this.u={x:t,y:s},this.Z=i,this.color=n}}class f{et=[];ht=[];ot=[];ct=[];rt=!1;backgroundColor="#557ad9";lt="red";ut="red";dt="red";ft="red";wt="#ffffff";width=500;height=500;Mt=!1;reset(){this.Mt=!1,this.rt=!1,this.et.forEach((t=>{t.reset()})),this.ht.forEach((t=>{t.reset()})),document.getElementById("js-place-wall").classList.remove("disabled"),document.getElementById("js-place-wall").setAttribute("disabled",!1),document.body.style.backgroundColor=this.lt}get bt(){for(let t=0;t<this.et.length;t++)if(!this.et[t].tt)return!1;return!0}}class w extends f{backgroundColor="#8eb087";constructor(){super(),this.ot=[new d(400,250)],this.et=[new u(250,250)]}}class M extends f{backgroundColor="#ffe55e";constructor(){super(),this.ot=[new d(400,125),new d(400,375)],this.et=[new u(250,125),new u(250,375)]}}class p extends f{backgroundColor="#ffe55e";constructor(){super(),this.ot=[new d(100,125),new d(400,375)],this.et=[new u(250,125),new u(250,375,Math.PI)]}}class m extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(400,125),new d(400,375)],this.et=[new u(50,125),new u(250,375,Math.PI)],this.ht=[new h(100,50,100,200,!1)]}}class b extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(400,125),new d(400,375)],this.et=[new u(150,125),new u(250,375,Math.PI)],this.ht=[new h(25,0,25,500,!1),new h(475,0,475,500,!1)]}}class x extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(250,150),new d(100,350),new d(400,350)];const t=[{x:100,y:200},{x:400,y:200},{x:250,y:400}],s=(t[0].x+t[1].x+t[2].x)/3,i=(t[0].y+t[1].y+t[2].y)/3,n=(t,n)=>Math.atan2(i-n,s-t);this.et=[new u(t[0].x,t[0].y,n(100,200)),new u(t[1].x,t[1].y,n(400,200)),new u(t[2].x,t[2].y,n(250,400))],this.ht=[]}}class v extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(150,400),new d(250,400),new d(350,400)],this.et=[new u(150,150),new u(250,200),new u(350,250)],this.ht=[]}}class y extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(250,250)];this.et=[new u(400,250,0),new u(250+150*Math.cos(Math.PI),250+150*Math.sin(Math.PI),Math.PI)]}}class g extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(250,300),new d(200,250)],this.et=[new u(250,200,0),new u(300,250,-Math.PI/2)],this.ht=[new h(200,200,300,300,!1),new h(300,200,200,300,!1)]}}class j extends f{backgroundColor="#374d93";constructor(){super(),this.ot=[new d(200,200),new d(400,400)],this.et=[new u(250,250,0),new u(300,300,Math.PI/2)],this.ht=[new h(100,200,200,100,!1)]}}const $=.25,k=.15,C=document.getElementById("canvas"),P=C.getContext("2d"),E={Mt:1,$:2,xt:4,vt:8,yt:16,gt:18,jt:32,$t:22};let F={kt:null,Ct:null,Pt:null,inputMode:E.Mt,Et:E.Mt};function I(){const t=window.innerWidth/C.width,s=window.innerHeight/C.height;return Math.min(t,s)}F.Ft=document.getElementById("game-ui"),F.title=document.getElementById("title-container"),document.getElementById("js-hit-ball").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(F.inputMode=E.Mt,t.currentTarget.classList.add("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-place-bump").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 2px ${W.dt}`,document.getElementById("js-place-wall").style.boxShadow=`0 5px ${W.dt}`,document.getElementById("js-place-bump").style.boxShadow=`0 5px ${W.dt}`)})),document.getElementById("js-place-wall").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(F.inputMode=E.$,t.currentTarget.classList.add("active"),document.getElementById("js-hit-ball").classList.remove("active"),document.getElementById("js-place-bump").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 5px ${W.dt}`,document.getElementById("js-place-wall").style.boxShadow=`0 2px ${W.dt}`,document.getElementById("js-place-bump").style.boxShadow=`0 5px ${W.dt}`)})),document.getElementById("js-place-bump").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(F.inputMode=E.yt,t.currentTarget.classList.add("active"),document.getElementById("js-hit-ball").classList.remove("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 5px ${W.dt}`,document.getElementById("js-place-wall").style.boxShadow=`0 5px ${W.dt}`,document.getElementById("js-place-bump").style.boxShadow=`0 2px ${W.dt}`)})),document.getElementById("js-reset").addEventListener("click",(t=>{t.preventDefault(),W.reset(),rt()}));const A=new h(0,0,0,0,!0,!0),B=[new w,new M,new p,new m,new b,new x,new v,new y,new g,new j],N=[.5,.5,.5],D=[.5,.5,.5],H=[2,1,0],J=[.5,.2,.25];for(let t=0;t<B.length;t++){const s=t/B.length,i=(t+1)/B.length,n=(t+2)/B.length;B[t].backgroundColor=Mt(s,N,D,H,J),B[t].lt=Mt(i,N,D,H,J);const e=Mt(n,N,D,H,J),h=Mt(n,N,D,H,J).slice(5).split(",").map(((t,s)=>3===s?1:Math.max(parseFloat(t)/2,0))).join(","),o=Mt(n,N,D,H,J).slice(5).split(",").map(((t,s)=>3===s?.5:Math.max(parseFloat(t)/2,0))).join(",");B[t].ut=e,B[t].dt=`rgba(${h})`,B[t].wt=mt(...pt(e)),B[t].ft=`rgba(${o})`}let T=0,V=(T+1)%B.length,W=B[T];W.reset();let z=B[V];const L=[],O=Math.hypot(C.width,C.height)/2;let q=O;const Q=5,R=new class{constructor(t,s,i,n){this.canvas=t,this.It=s,this.At=i,this.Bt=n,this.Nt={x:0,y:0},this.Dt={x:0,y:0},this.Ht={x:0,y:0},this.Jt={x:0,y:0},this.pressed=!1,this.boundingRect=this.canvas.getBoundingClientRect(),this.Tt(this.canvas)}resize(){this.boundingRect=this.canvas.getBoundingClientRect()}Tt(t){t.addEventListener("mousedown",this.Vt.bind(this),{capture:!0,passive:!1}),window.addEventListener("mousemove",this.Wt.bind(this),{capture:!0,passive:!1}),window.addEventListener("mouseup",this.zt.bind(this),{capture:!0,passive:!1}),t.addEventListener("touchstart",this.Lt.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchend",this.zt.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchmove",this.Ot.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchcancel",this.zt.bind(this),{capture:!0,passive:!1})}qt(){this.Ht.x=(this.Dt.x-this.Nt.x)/t,this.Ht.y=(this.Nt.y-this.Dt.y)/t}Qt(t){const s=canvas.getBoundingClientRect();let i,n;if(t instanceof MouseEvent)i=t.clientX-s.left,n=t.clientY-s.top;else if(t instanceof TouchEvent){const t=event.touches[0];i=t.clientX-s.left,n=t.clientY-s.top}i*=canvas.width/s.width,n*=canvas.height/s.height,this.Jt.x=i,this.Jt.y=n}Rt(t){let s=0;return t instanceof MouseEvent?s=t.clientX:t instanceof TouchEvent&&(s=t.changedTouches[0].clientX),(s-this.boundingRect.left)*(this.canvas.width/this.boundingRect.width)}St(t){let s=0;return t instanceof MouseEvent?s=t.clientY:t instanceof TouchEvent&&(s=t.changedTouches[0].clientY),(s-this.boundingRect.top)*(this.canvas.height/this.boundingRect.height)}Lt(t){t.preventDefault(),this.Qt(t),this.Ut(this.Rt(t),this.St(t))}Ot(t){t.preventDefault(),this.Qt(t),this.Gt(this.Rt(t),this.St(t)),console.log(this.pressed)}Vt(t){t.preventDefault(),this.Qt(t),this.Ut(this.Rt(t),this.St(t))}Wt(t){t.preventDefault(),this.Qt(t),this.Gt(this.Rt(t),this.St(t))}Ut(t,s){this.pressed=!0,this.Nt.x=t,this.Nt.y=s,this.Dt.x=t,this.Dt.y=s,this.qt(),this.It()}Gt(s,i){if(!this.pressed)return;const n=s-this.Nt.x,e=i-this.Nt.y,h=Math.hypot(n,e);if(this.Dt.x=s,this.Dt.y=i,h>t){const s=n/h*t,i=e/h*t;this.Dt.x=this.Nt.x+s,this.Dt.y=this.Nt.y+i}this.qt(),this.Bt()}zt(t){0!=this.pressed&&(t.preventDefault(),t.stopPropagation(),this.pressed=!1,this.Nt.x=0,this.Nt.y=0,this.Dt.x=0,this.Dt.y=0,this.qt(),this.At())}draw(t){this.pressed&&(this.Kt(t),this.Xt(t))}Kt(s){s.strokeStyle="#FFD700",s.lineWidth=6,s.beginPath(),s.arc(this.Nt.x,this.Nt.y,t,0,2*Math.PI),s.stroke(),s.closePath()}Xt(t){t.strokeStyle="#F0E68C",t.lineWidth=6,t.beginPath(),t.arc(this.Dt.x,this.Dt.y,125,0,2*Math.PI),t.fillStyle="#F0E68C",t.globalAlpha=.5,t.fill(),t.globalAlpha=1,t.closePath()}}(C,(function(){F.title.style.opacity=0;for(let t=0;t<W.ht.length;t++){const s=W.ht[t];if(!s.j)continue;const i=s.V(R.Jt.x,R.Jt.y);if(s.O(R.Jt.x,R.Jt.y))return void W.ht.splice(t,1);if(i)return F.Et=F.inputMode,F.inputMode=E.xt,F.Ct=s,void(F.Pt=i);s.J(R.Jt.x,R.Jt.y)&&(F.Et=F.inputMode,F.inputMode=E.vt,F.Ct=s,F.Pt=null)}for(let t=0;t<W.ct.length;t++){const s=W.ct[t];if(!s.j)continue;const i=s.V(R.Jt.x,R.Jt.y);if(s.O(R.Jt.x,R.Jt.y))return void W.ct.splice(t,1);if(i)return F.Et=F.inputMode,F.inputMode=E.xt,F.Ct=s,void(F.Pt=i);s.J(R.Jt.x,R.Jt.y)&&(F.Et=F.inputMode,F.inputMode=E.vt,F.Ct=s,F.Pt=null)}F.inputMode===E.Mt?function(){L.length=0;for(let t=0;t<W.et.length;t++){const s=W.et[t];L.push(new o(s.u.x,s.u.y,R.Ht.x,R.Ht.y))}}():F.inputMode&E.gt&&S.C.push({x:R.Jt.x,y:R.Jt.y})}),(function(){F.inputMode===E.Mt?function(){if(0===L.length)return;for(let t=0;t<W.et.length;t++){const s=W.et[t];if(s.tt)continue;const i=L[t],n=Math.cos(i.angle)*i.U*.05,e=Math.sin(i.angle)*i.U*.05;s.M.x=n,s.M.y=e}L.length=0,W.Mt=!0,F.inputMode=E.jt,C.style.cursor="not-allowed",document.getElementById("js-hit-ball").classList.add("disabled"),document.getElementById("js-place-wall").classList.add("disabled"),document.getElementById("js-place-bump").classList.add("disabled");const t=document.getElementById("js-reset");t.classList.remove("disabled"),Array.from(document.getElementsByClassName("button")).forEach((t=>{"js-reset"!==t.id&&(t.style.backgroundColor=null,t.style.boxShadow=null)})),t.style.backgroundColor=W.ut,t.style.boxShadow=`0 5px ${W.dt}`,t.style.color=W.wt}():F.inputMode&E.gt?function(){if(S.C.length<2)return;F.inputMode===E.$?W.ht.push(new h(S.C[0].x,S.C[0].y,S.C[1].x,S.C[1].y,!0)):F.inputMode===E.yt&&W.ct.push(new h(S.C[0].x,S.C[0].y,S.C[1].x,S.C[1].y,!0,!1));S=new c}():(F.inputMode===E.xt||F.inputMode===E.vt)&&(F.inputMode=F.Et,F.Ct=null,F.Pt=null);F.Ft.style.backgroundColor=null}),(function(){F.inputMode===E.Mt?function(){let t=1;for(let s=0;s<L.length;s++){const i=L[s],n=W.et[s];if(n.tt)continue;t=n.st;const e=t+U(R),h=Z(R.Dt.x,R.Dt.y,R.Nt.x,R.Nt.y);i.angle=e,i.U=h}}():F.inputMode&E.gt&&R.pressed||(F.inputMode===E.xt?F.Pt&&(F.Pt===F.Ct.t?F.Ct.k(R.Jt.x,R.Jt.y,F.Ct.i.x,F.Ct.i.y):F.Ct.k(F.Ct.t.x,F.Ct.t.y,R.Jt.x,R.Jt.y)):F.inputMode===E.vt&&function(){if(F.Ct){const t=R.Jt.x-F.Ct.u.x,s=R.Jt.y-F.Ct.u.y;F.Ct.k(F.Ct.t.x+t,F.Ct.t.y+s,F.Ct.i.x+t,F.Ct.i.y+s)}}())}));let S=new c;function U(t){return Math.atan2(-(t.Dt.y-t.Nt.y),-(t.Dt.x-t.Nt.x))}function G(t){t.u.x+t.Z<0&&(t.u.x=C.width-t.Z),t.u.x-t.Z>C.width&&(t.u.x=t.Z),t.u.y+t.Z<0&&(t.u.y=C.height-t.Z),t.u.y-t.Z>C.height&&(t.u.y=t.Z)}function K(t,s){const i=t.u.x-s.u.x,n=t.u.y-s.u.y;return Math.sqrt(i*i+n*n)<t.Z+s.Z}function X(t,s){const i=t.u.x-s.u.x,n=t.u.y-s.u.y,e=Math.sqrt(i*i+n*n);if(e>t.Z+s.Z)return 0;const h=t.Z+s.Z;return(h-e)/h}function Y(t,s){const i=s.u.x-t.u.x,n=s.u.y-t.u.y,e=Math.sqrt(i*i+n*n);if(0===e)return;const h=t.Z+s.Z-e,o=i/e,c=n/e;h>0&&(t.u.x-=h*o*(s.Y/(t.Y+s.Y)),t.u.y-=h*c*(s.Y/(t.Y+s.Y)),s.u.x+=h*o*(t.Y/(t.Y+s.Y)),s.u.y+=h*c*(t.Y/(t.Y+s.Y)));const a=(s.M.x-t.M.x)*o+(s.M.y-t.M.y)*c;if(a>0)return;const r=-2*a/(1/t.Y+1/s.Y);t.M.x-=r/t.Y*o,t.M.y-=r/t.Y*c,s.M.x+=r/s.Y*o,s.M.y+=r/s.Y*c}function Z(t,s,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-s,2))}function _(t){t.u.x-t.Z<0&&tt(t,t.u.x+C.width,t.u.y),t.u.x+t.Z>C.width&&tt(t,t.u.x-C.width,t.u.y),t.u.y-t.Z<0&&tt(t,t.u.x,t.u.y+C.height),t.u.y+t.Z>C.height&&tt(t,t.u.x,t.u.y-C.height),tt(t,t.u.x,t.u.y)}function tt(t,s,i){P.beginPath(),P.arc(s,i,t.Z,0,2*Math.PI),P.fillStyle=`rgba(255, 255, 255, ${t.alpha})`,P.strokeStyle=`rgba(0, 0, 0, ${t.alpha})`,P.lineWidth=5,P.setLineDash([]),P.closePath(),P.stroke(),P.fill()}function st(t){P.beginPath(),P.arc(t.u.x,t.u.y,t.Z,0,2*Math.PI),P.fillStyle=t.color,P.fill(),P.closePath()}function it(t){P.fillStyle=t.backgroundColor,P.fillRect(0,0,C.width,C.height);for(let s=0;s<t.ot.length;s++){st(t.ot[s])}for(let s=0;s<t.ht.length;s++){t.ht[s].draw(P)}for(let s=0;s<t.ct.length;s++){t.ct[s].draw(P)}F.inputMode&E.gt&&S.C.length>0&&(A.k(S.C[0].x,S.C[0].y,R.Jt.x,R.Jt.y),A.$=F.inputMode===E.$,A.draw(P));for(let s=0;s<t.et.length;s++){_(t.et[s])}}function nt(){P.clearRect(0,0,C.width,C.height),W.bt&&(it(z),P.save(),P.beginPath(),P.arc(C.width/2,C.height/2,q,0,2*Math.PI),P.closePath(),P.clip()),it(W),W.bt&&P.restore();for(let t=0;t<L.length;t++){const s=L[t];W.et[t].tt||et(P,s.S.x,s.S.y,s.K.x,s.K.y)}if(P.fillStyle="white",P.font="30px Arial",F.Ft.innerText="",F.inputMode&E.$t){let t;if(F.inputMode&E.xt?t=F.Ct:F.inputMode&E.gt&&(t=S),t&&t.C.length>0){if(1===t.C.length){const s=R.Jt.x-t.C[0].x,i=R.Jt.y-t.C[0].y,n=180*Math.atan2(i,s)/Math.PI;F.Ft.innerText=`${n.toFixed(0)}`,-0===n&&(F.Ft.innerText="0")}else{const s=t.C[1].x-t.C[0].x,i=t.C[1].y-t.C[0].y,n=180*Math.atan2(i,s)/Math.PI;F.Ft.innerText=`${n.toFixed(0)}`,-0===n&&(F.Ft.innerText="0")}F.Ft.style.color=mt(...pt(W.backgroundColor)),F.Ft.style.backgroundColor=W.ft}else F.Ft.style.backgroundColor=null}}function et(t,s,i,n,e){const h=Z(s,i,n,e);var o=Math.min(h,20),c=Math.atan2(e-i,n-s);t.fillStyle="#fff",t.strokeStyle="#000",t.lineWidth=5,t.beginPath(),t.moveTo(s,i),t.lineTo(n-o/2*Math.cos(c),e-o/2*Math.sin(c)),t.stroke(),t.strokeStyle="#fff",t.fillStyle="#fff",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(n,e),t.lineTo(n-o*Math.cos(c-Math.PI/6),e-o*Math.sin(c-Math.PI/6)),t.lineTo(n-o*Math.cos(c+Math.PI/6),e-o*Math.sin(c+Math.PI/6)),t.closePath(),t.fill(),t.lineWidth=3,t.strokeStyle="#000",t.stroke(),t.fillStyle="#fff",t.fill(),t.beginPath(),t.moveTo(s,i),t.lineTo(n-o/2*Math.cos(c),e-o/2*Math.sin(c)),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.fillStyle="#fff",t.beginPath(),t.arc(s,i,5,0,2*Math.PI),t.fill(),t.closePath()}function ht(t){for(let s=0;s<W.et.length;s++){const i=W.et[s],n=L[s];i.update(t);for(let t=0;t<W.et.length;t++){if(s===t)continue;const n=W.et[t];i.tt||n.tt||i.alpha<.5||K(i,n)&&Y(i,n)}n&&(n.S.x=i.u.x,n.S.y=i.u.y),F.inputMode===E.jt&&(G(i),lt(i),ot(i),ct(i))}if(W.bt&&(q-=Q,q<=0&&at(T+2)),W.Mt)for(let t=0;t<W.et.length;t++){const s=W.et[t];s.tt||(null===F.kt&&(F.kt=Date.now()),Z(s.M.x,s.M.y,0,0)<k?null===F.kt&&(F.kt=Date.now()):F.kt=null,null!==F.kt&&Date.now()-F.kt>1e3&&(W.reset(),rt()))}for(let t=0;t<W.ht.length;t++){const s=W.ht[t];s.v&&s.update()}}function ot(t){for(let s=0;s<W.ht.length;s++){const i=W.ht[s];if(i.v)continue;const n=l(t,i);if(n){const s=.5*Math.hypot(t.M.x,t.M.y);i.N(s),t.u.x+=n.X.x,t.u.y+=n.X.y;const e=n.axis,h=t.M.x*e.x+t.M.y*e.y;t.M.x-=2*h*e.x,t.M.y-=2*h*e.y}}}function ct(t){t.Yt=1;for(let s=0;s<W.ct.length;s++){const i=l(t,W.ct[s]);t.nt=i?.09:0}}function at(t){T=(t-1)%B.length;const s=(T+1)%B.length;W=B[T],z=B[s],q=O,W.reset(),rt(),location.hash=`#/${T+1}`}function rt(){document.getElementById("js-hit-ball").classList.add("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-place-bump").classList.remove("active"),document.getElementById("js-reset").classList.remove("active"),document.getElementById("js-hit-ball").classList.remove("disabled"),document.getElementById("js-place-wall").classList.remove("disabled"),document.getElementById("js-place-bump").classList.remove("disabled");const t=document.getElementById("js-reset");t.classList.add("disabled"),Array.from(document.getElementsByClassName("button")).forEach((t=>{t.style.backgroundColor=W.ut,t.style.boxShadow=`0 5px ${W.dt}`,t.style.color=W.wt})),t.style.backgroundColor=null,t.style.boxShadow=null,t.style.color=null,F.kt=null,F.Ct=null,F.Pt=null,F.inputMode=E.Mt,C.style.cursor="crosshair"}function lt(t){t.it=!1;for(let s=0;s<W.ot.length;s++){const i=W.ot[s],n=i.u.x-t.u.x,e=i.u.y-t.u.y,h=Math.sqrt(n*n+e*e),o=Math.sqrt(t.M.x*t.M.x+t.M.y*t.M.y);if(h<=i.Z-t.Z&&o<$)t.tt=i,t.it=!0;else if(K(t,i)){const s=.2*X(t,i),o=s*n/h,c=s*e/h;t.M.x+=o,t.M.y+=c,t.alpha-=.01,t.alpha=Math.max(t.alpha,0),t.it=!0}}t.it||(t.alpha=1)}const ut=1e3/60;let dt=0,ft=0;function wt(){const t=window.location.hash.substring(2);return 0===t.length?1:parseInt(t,10)}function Mt(t,s,i,n,e){const h=[0,0,0];for(let o=0;o<3;o++)h[o]=s[o]+i[o]*Math.cos(6.28318*(n[o]*t+e[o]));return`rgba(${255*h[0]}, ${255*h[1]}, ${255*h[2]}, 1.0)`}function pt(t){return t.slice(5).split(",").map(parseFloat).slice(0,3)}function mt(t,s,i){const n=function(t,s,i){return.299*t+.587*s+.114*i}(t,s,i);return n>128?"black":"white"}!function t(s){const i=s-ft;for(ft=s,dt+=i;dt>=ut;)ht(ut),dt-=ut;nt(),requestAnimationFrame(t)}(0),document.addEventListener("DOMContentLoaded",(()=>{at(wt()),document.getElementById("js-hit-ball").click()})),window.addEventListener("hashchange",(()=>{at(wt())})),window.addEventListener("mousemove",(t=>{const s=C.getBoundingClientRect();let i="crosshair";for(let n=0;n<W.ht.length;n++){let e=t.clientX-s.left,h=t.clientY-s.top;const o=W.ht[n];e/=I(),h/=I(),o.O(e,h)?i="pointer":(o.V(e,h)||o.J(e,h))&&(i="grab")}for(let n=0;n<W.ct.length;n++){let e=t.clientX-s.left,h=t.clientY-s.top;const o=W.ct[n];e/=I(),h/=I(),o.O(e,h)?i="pointer":(o.V(e,h)||o.J(e,h))&&(i="grab")}F.inputMode===E.jt&&(i="not-allowed"),C.style.cursor=i}))})();