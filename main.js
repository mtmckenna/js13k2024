(()=>{"use strict";const t=250;class s{constructor(t,s,n){this.t=t,this.o=s,this.color=n,this.i=[],this.h()}h(){const{t,o:s,color:i}=this,e=Math.atan2(s.y-t.y,s.x-t.x),h=Math.hypot(s.x-t.x,s.y-t.y);for(let s=0;s<Math.ceil(h/o);s++){const h=t.x+Math.cos(e)*s*o,a=t.y+Math.sin(e)*s*o;this.i.push(new n(h,a,i,e))}this.angle=e}reset(){this.i=[],this.h()}update(){for(let t=0;t<this.i.length;t++)this.i[t].l<=0||this.i[t].update()}draw(t){for(let s=0;s<this.i.length;s++)this.i[s].l<=0||this.i[s].draw(t)}}class n{constructor(t,s,n,o){this.color=n,this.u={x:t,y:s},this.M={x:0,y:0},this.color=n,this.l=100,this.angle=o}update(){this.u.x+=this.M.x,this.u.y+=this.M.y,this.l--}draw(t){this.left<0||(this.l<75?t.fillStyle=`rgba(${this.color}, ${this.l/75})`:t.fillStyle=`rgba(${this.color}, 1)`,t.beginPath(),t.rect(this.u.x-o/2,this.u.y,o,o),t.fill(),t.closePath())}}const o=20,i="255,255,255";class e{constructor(t,n,e,h,a=!0,r=!0){this.width=o,this.u={x:0,y:0},this.t={x:0,y:0},this.o={x:0,y:0},this.p={x:0,y:0},this.m={x:0,y:0},this.C=!1,this.B=a,this.color=a?i:"0,0,0",this.v(t,n,e,h),this.$=new s(this.t,this.o,this.color)}v(t,s,n,o){this.t.x=t,this.t.y=s,this.o.x=n,this.o.y=o;const{t:i,o:e}=this;this.u.x=(i.x+e.x)/2,this.u.y=(i.y+e.y)/2,this.angle=Math.atan2(e.y-i.y,e.x-i.x)-Math.PI/2,this.k=this.F(i,e,this.width),this.A=this.j();const h=6*Math.sin(this.angle),a=6*-Math.cos(this.angle);this.p.x=this.t.x-h,this.p.y=this.t.y-a,this.m.x=this.o.x+h,this.m.y=this.o.y+a}update(){this.C&&this.$.update()}rotate(t,s,n){const o=this.t.x,i=this.t.y,e=this.o.x,h=this.o.y,a=Math.cos(t),r=Math.sin(t),c=a*(o-s)-r*(i-n)+s,l=r*(o-s)+a*(i-n)+n,u=a*(e-s)-r*(h-n)+s,d=r*(e-s)+a*(h-n)+n;this.v(c,l,u,d)}D(){}reset(){this.C=!1,this.$.reset()}P(t){this.C=!0,this.$=new s(this.t,this.o,this.color),this.$.i.forEach((s=>{const n=Math.random()*Math.PI*2;s.M.x=t*(2*Math.random()-1)*Math.cos(n),s.M.y=t*(2*Math.random()-1)*Math.sin(n)}))}F(t,s,n){const o=n/2,i=Math.sqrt((s.x-t.x)**2+(s.y-t.y)**2)/2,e=this.angle;return[{x:-o,y:-i},{x:-o,y:i},{x:o,y:i},{x:o,y:-i}].map((t=>({x:this.u.x+(t.x*Math.cos(e)-t.y*Math.sin(e)),y:this.u.y+(t.x*Math.sin(e)+t.y*Math.cos(e))})))}j(){const t=[],s=this.k,n=s.length;for(let o=0;o<n;o++){const i=(o+1)%n,e=s[i].x-s[o].x,h=s[i].y-s[o].y,a=Math.sqrt(e*e+h*h),r={x:-h/a,y:e/a};t.push(r)}return t}S(t){let s=Number.POSITIVE_INFINITY,n=-Number.POSITIVE_INFINITY;for(let o=0;o<this.k.length;o++){let i=this.k[o].x*t.x+this.k[o].y*t.y;s=Math.min(s,i),n=Math.max(n,i)}return{min:s,max:n}}I(t,s,n,o,i){const e=t-n,h=s-o;return e*e+h*h<=i*i}H(t,s){return this.T(t,s)}T(t,s){let n=!1;const o=this.k,i=o.length;for(let e=0,h=i-1;e<i;h=e++){const i=o[e].x,a=o[e].y,r=o[h].x,c=o[h].y;a>s!=c>s&&t<(r-i)*(s-a)/(c-a)+i&&(n=!n)}return n}N(t,s){return this.J(t,s)?this.t:this.L(t,s)?this.o:null}J(t,s){return this.I(t,s,this.p.x,this.p.y,15)}L(t,s){return this.I(t,s,this.m.x,this.m.y,15)}V(t,s){return this.B?this.I(t,s,this.u.x,this.u.y,15):null}draw(t){this.C?this.$.draw(t):this.W(t)}W(t){t.beginPath(),t.setLineDash([]),t.fillStyle=`rgba(${this.color}, 1.0)`,t.strokeStyle="#000",t.lineWidth=2,t.moveTo(this.k[0].x,this.k[0].y);for(let s=1;s<this.k.length;s++)t.lineTo(this.k[s].x,this.k[s].y);t.closePath(),t.fill(),t.stroke(),this.color===i&&(t.beginPath(),t.lineWidth=2,t.strokeStyle="red",t.moveTo(this.u.x-5,this.u.y-5),t.lineTo(this.u.x+5,this.u.y+5),t.moveTo(this.u.x-5,this.u.y+5),t.lineTo(this.u.x+5,this.u.y-5),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="rgba(255, 0, 0, 1.0)",t.arc(this.p.x,this.p.y,4,0,2*Math.PI),t.arc(this.m.x,this.m.y,4,0,2*Math.PI),t.fill())}}class h{constructor(t=0,s=0,n=0,o=1){this.O={x:t,y:s},this.angle=n,this.q=o,this.R={x:t,y:s}}get U(){return this.R.x=this.O.x+this.q*Math.cos(this.angle),this.R.y=this.O.y+this.q*Math.sin(this.angle),this.R}}class a{constructor(){this.k=[]}}function r(t,s){return t.max>s.min&&s.max>t.min}function c(t,s){return Math.min(t.max-s.min,s.max-t.min)}function l(t,s){let n=Number.POSITIVE_INFINITY,o=null,i=null;for(let e=0;e<s.A.length;e++){const h=s.A[e],a=s.S(h),l=t.S(h);if(!r(a,l))return null;{const t=c(a,l);t<n&&(n=t,o=h,i=s.k[e])}}for(const e of s.k){const h={x:t.u.x-e.x,y:t.u.y-e.y},a=Math.sqrt(h.x*h.x+h.y*h.y);if(0===a)continue;h.x/=a,h.y/=a;const l=s.S(h),u=t.S(h);if(!r(l,u))return null;{const t=c(l,u);t<n&&(n=t,o=h,i=e)}}if(n===Number.POSITIVE_INFINITY)return null;let e=t.u.x-i.x,h=t.u.y-i.y;return e*o.x+h*o.y<0&&(o.x=-o.x,o.y=-o.y),{G:{x:o.x*n,y:o.y*n},axis:o}}class u{K=1;constructor(t,s,n=Math.PI,o=8){this.X=o,this.color="#fff",this.u={x:t,y:s},this.Y={x:t,y:s},this.M={x:0,y:0},this.Z=null,this.K=o,this._=n,this.u.x=t,this.u.y=s,this.alpha=1,this.tt=0}S(t){const s=this.u.x*t.x+this.u.y*t.y;return{min:s-this.X,max:s+this.X}}update(){const t=.98-this.tt;this.M.x*=t,this.M.y*=t,Math.abs(this.M.x)<.01&&(this.M.x=0),Math.abs(this.M.y)<.01&&(this.M.y=0),this.u.x+=this.M.x,this.u.y+=this.M.y}reset(){this.u.x=this.Y.x,this.u.y=this.Y.y,this.Z=null,this.M.x=0,this.M.y=0,this.st=!1,this.alpha=1}}class d{Z=null;constructor(t,s,n=15,o="black"){this.u={x:t,y:s},this.X=n,this.color=o}}class f{nt=[];ot=[];it=[];et=!1;backgroundColor="red";ht="red";rt="red";ct="red";lt="#ffffff";width=500;height=500;ut=!1;reset(){this.ut=!1,this.et=!1,this.nt.forEach((t=>{t.reset()})),this.ot.forEach((t=>{t.reset()})),document.getElementById("js-place-wall").classList.remove("disabled"),document.getElementById("js-place-wall").setAttribute("disabled",!1),document.body.style.backgroundColor=this.ht}get dt(){for(let t=0;t<this.nt.length;t++)if(!this.nt[t].Z)return!1;return!0}update(){}}class w extends f{backgroundColor="#B4E7CE";ht="#59A96A";rt="#9BDEAC";ct="#474A2C";constructor(){super(),this.it=[new d(400,250)],this.nt=[new u(250,250)]}}class M extends f{backgroundColor="#BB8A89";ht="#977390";rt="#AC7B7D";ct="#785589";constructor(){super(),this.it=[new d(400,125),new d(400,375)],this.nt=[new u(250,125),new u(250,375)]}}class p extends f{backgroundColor="#F4F4F9";ht="#586F7C";rt="#B8DBD9";ct="#2F4550";constructor(){super(),this.it=[new d(100,125),new d(400,375)],this.nt=[new u(250,125),new u(250,375,0)]}}class m extends f{backgroundColor="#AFB3F7";ht="#7A93AC";rt="#92BCEA";ct="#617073";constructor(){super(),this.it=[new d(400,125),new d(400,375)],this.nt=[new u(50,125),new u(250,375,0)],this.ot=[new e(100,50,100,200,!1)]}}class C extends f{backgroundColor="#FEC0AA";ht="#84732B";rt="#EC4E20";ct="#574F2A";constructor(){super(),this.it=[new d(400,125),new d(400,375)],this.nt=[new u(150,125),new u(250,375,0)],this.ot=[new e(25,0,25,500,!1),new e(475,0,475,500,!1)]}}class x extends f{backgroundColor="#F2F6D0";ht="#D9D2B6";rt="#D0E1D4";ct="#71697A";constructor(){super(),this.it=[new d(250,150),new d(100,350),new d(400,350)];const t=[{x:100,y:200},{x:400,y:200},{x:250,y:400}],s=(t[0].x+t[1].x+t[2].x)/3,n=(t[0].y+t[1].y+t[2].y)/3,o=(t,o)=>Math.atan2(n-o,s-t);this.nt=[new u(t[0].x,t[0].y,o(100,200)),new u(t[1].x,t[1].y,o(400,200)),new u(t[2].x,t[2].y,o(250,400))],this.ot=[]}}class B extends f{backgroundColor="#FAA275";ht="#CE6A85";rt="#FF8C61";ct="#985277";constructor(){super(),this.it=[new d(150,400),new d(250,400),new d(350,400)],this.nt=[new u(150,150),new u(250,200),new u(350,250)],this.ot=[]}}class b extends f{backgroundColor="#BEEF9E";ht="#828C51";rt="#A6C36F";ct="#335145";constructor(){super(),this.it=[new d(250,250)];this.nt=[new u(400,250,0),new u(250+150*Math.cos(Math.PI),250+150*Math.sin(Math.PI),Math.PI)]}}class v extends f{backgroundColor="#CF9893";ht="#A96DA3";rt="#BC7C9C";ct="#3B3B58";constructor(){super(),this.it=[new d(250,300),new d(200,250)],this.nt=[new u(250,200,-Math.PI),new u(300,250,-Math.PI/2)],this.ot=[new e(200,200,300,300,!1),new e(300,200,200,300,!1)]}}class $ extends f{backgroundColor="#FFA9E7";ht="#7F2CCB";rt="#FF84E8";ct="#414361";constructor(){super(),this.it=[new d(200,200),new d(400,400)],this.nt=[new u(250,250,-Math.PI),new u(300,300,-Math.PI/2)],this.ot=[new e(100,200,200,100,!1)]}}class k extends f{backgroundColor="#93B5C6";ht="#F0CF65";rt="#D7816A";ct="#BD4F6C";constructor(){super(),this.it=[new d(100,100),new d(250,100),new d(400,100)],this.nt=[new u(250,200,Math.PI),new u(175,325,Math.PI/4),new u(325,325,-Math.PI/4)],this.ot=[]}}class g extends f{backgroundColor="#524948";ht="#7CB4B8";rt="#70F8BA";ct="#57467B";constructor(){super(),this.it=[new d(200,200),new d(300,200)],this.nt=[new u(100,250,Math.PI),new u(400,250,Math.PI/3)],this.ot=[new e(125,125,175,300,!1),new e(375,125,325,300,!1),new e(125,125,175,150,!1),new e(375,125,325,150,!1),new e(175,150,325,150,!1),new e(175,300,325,300,!1),new e(200,250,200,275,!1),new e(300,250,300,275,!1),new e(200,275,300,275,!1)]}}class y extends f{backgroundColor="#6A8D73";ht="#E4FFE1";rt="#FFE8C2";ct="#F0A868";constructor(){super(),this.it=[new d(250,250)],this.nt=[new u(250,100,Math.PI)];const t=new e(175,150,175,350,!1),s=new e(325,150,325,350,!1),n=new e(185,160,315,160,!1),o=new e(185,340,315,340,!1);this.ot=[t,s,n,o],this.ft=[t,s,n,o]}update(){super.update();for(let t=0;t<this.ft.length;t++){this.ft[t].rotate(.01,250,250)}}}const F=.25,A=.15,E=2,j=document.getElementById("canvas"),D=j.getContext("2d"),P={ut:1,wt:2,Mt:4,Ct:8,xt:16,Bt:18,bt:32,vt:22};let S={$t:null,kt:null,gt:null,inputMode:P.ut,yt:P.ut,Ft:"",At:"",Et:"",jt:"",Dt:{x:0,y:0}};function I(){const t=document.getElementById("js-hit-ball");t.classList.contains("disabled")||(S.inputMode=P.ut,t.classList.add("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 2px ${V.ct}`,document.getElementById("js-place-wall").style.boxShadow=`0 5px ${V.ct}`)}function H(){const t=window.innerWidth/j.width,s=window.innerHeight/j.height;return Math.min(t,s)}S.Pt=document.getElementById("game-ui"),S.title=document.getElementById("title-container"),S.St=document.getElementById("hole-number"),S.It=document.getElementById("canvas-container"),S.Ht=document.getElementById("js-prev"),S.Tt=document.getElementById("js-next"),document.getElementById("js-hit-ball").addEventListener("click",(t=>{t.preventDefault(),I()})),document.getElementById("js-place-wall").addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||(S.inputMode=P.wt,t.currentTarget.classList.add("active"),document.getElementById("js-hit-ball").classList.remove("active"),document.getElementById("js-hit-ball").style.boxShadow=`0 5px ${V.ct}`,document.getElementById("js-place-wall").style.boxShadow=`0 2px ${V.ct}`)})),document.getElementById("js-reset").addEventListener("click",(t=>{t.preventDefault(),xt(),ut()})),S.Ht.addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||lt(J)})),S.Tt.addEventListener("click",(t=>{t.preventDefault(),t.currentTarget.classList.contains("disabled")||lt(J+2)}));const T=new e(0,0,0,0,!0,!0),N=[new w,new M,new p,new m,new C,new x,new B,new b,new v,new $,new k,new g,new y];let J=0,L=(J+1)%N.length,V=N[J];V.reset();let W=N[L];const z=[],O=Math.hypot(j.width,j.height)/2;let q=O;const Q=5,R=new class{constructor(t,s,n,o){this.canvas=t,this.Nt=s,this.Jt=n,this.Lt=o,this.Vt={x:0,y:0},this.Wt={x:0,y:0},this.zt={x:0,y:0},this.Ot={x:0,y:0},this.pressed=!1,this.boundingRect=this.canvas.getBoundingClientRect(),this.qt(this.canvas)}resize(){this.boundingRect=this.canvas.getBoundingClientRect()}qt(t){t.addEventListener("mousedown",this.Qt.bind(this),{capture:!0,passive:!1}),window.addEventListener("mousemove",this.Rt.bind(this),{capture:!0,passive:!1}),window.addEventListener("mouseup",this.Ut.bind(this),{capture:!0,passive:!1}),t.addEventListener("touchstart",this.Gt.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchend",this.Ut.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchmove",this.Kt.bind(this),{capture:!0,passive:!1}),window.addEventListener("touchcancel",this.Ut.bind(this),{capture:!0,passive:!1})}Xt(){this.zt.x=(this.Wt.x-this.Vt.x)/t,this.zt.y=(this.Vt.y-this.Wt.y)/t}Yt(t){const s=canvas.getBoundingClientRect();let n,o;if(t instanceof MouseEvent)n=t.clientX-s.left,o=t.clientY-s.top;else if(t instanceof TouchEvent){const t=event.touches[0];n=t.clientX-s.left,o=t.clientY-s.top}n*=canvas.width/s.width,o*=canvas.height/s.height,this.Ot.x=n,this.Ot.y=o}Zt(t){let s=0;return t instanceof MouseEvent?s=t.clientX:t instanceof TouchEvent&&(s=t.changedTouches[0].clientX),(s-this.boundingRect.left)*(this.canvas.width/this.boundingRect.width)}_t(t){let s=0;return t instanceof MouseEvent?s=t.clientY:t instanceof TouchEvent&&(s=t.changedTouches[0].clientY),(s-this.boundingRect.top)*(this.canvas.height/this.boundingRect.height)}Gt(t){t.preventDefault(),this.Yt(t),this.ts(this.Zt(t),this._t(t))}Kt(t){t.preventDefault(),this.Yt(t),this.ss(this.Zt(t),this._t(t)),console.log(this.pressed)}Qt(t){t.preventDefault(),this.Yt(t),this.ts(this.Zt(t),this._t(t))}Rt(t){t.preventDefault(),this.Yt(t),this.ss(this.Zt(t),this._t(t))}ts(t,s){this.pressed=!0,this.Vt.x=t,this.Vt.y=s,this.Wt.x=t,this.Wt.y=s,this.Xt(),this.Nt()}ss(s,n){if(!this.pressed)return;const o=s-this.Vt.x,i=n-this.Vt.y,e=Math.hypot(o,i);if(this.Wt.x=s,this.Wt.y=n,e>t){const s=o/e*t,n=i/e*t;this.Wt.x=this.Vt.x+s,this.Wt.y=this.Vt.y+n}this.Xt(),this.Lt()}Ut(t){0!=this.pressed&&(t.preventDefault(),t.stopPropagation(),this.pressed=!1,this.Vt.x=0,this.Vt.y=0,this.Wt.x=0,this.Wt.y=0,this.Xt(),this.Jt())}draw(t){this.pressed&&(this.ns(t),this.os(t))}ns(s){s.strokeStyle="#FFD700",s.lineWidth=6,s.beginPath(),s.arc(this.Vt.x,this.Vt.y,t,0,2*Math.PI),s.stroke(),s.closePath()}os(t){t.strokeStyle="#F0E68C",t.lineWidth=6,t.beginPath(),t.arc(this.Wt.x,this.Wt.y,125,0,2*Math.PI),t.fillStyle="#F0E68C",t.globalAlpha=.5,t.fill(),t.globalAlpha=1,t.closePath()}}(j,(function(){if(S.Dt.x=R.Ot.x,S.Dt.y=R.Ot.y,S.Pt.innerHTML=S.jt,S.inputMode!==P.bt)for(let t=0;t<V.ot.length;t++){const s=V.ot[t];if(!s.B)continue;const n=s.N(R.Ot.x,R.Ot.y);if(s.V(R.Ot.x,R.Ot.y))return void V.ot.splice(t,1);if(n)return S.yt=S.inputMode,S.inputMode=P.Mt,S.kt=s,void(S.gt=n);s.H(R.Ot.x,R.Ot.y)&&(S.yt=S.inputMode,S.inputMode=P.Ct,S.kt=s,S.gt=null)}S.inputMode===P.ut?function(){z.length=0;for(let t=0;t<V.nt.length;t++){const s=V.nt[t];z.push(new h(s.u.x,s.u.y,R.zt.x,R.zt.y))}}():S.inputMode&P.Bt&&U.k.push({x:R.Ot.x,y:R.Ot.y})}),(function(){S.inputMode===P.ut?function(){if(0===z.length)return;for(let t=0;t<V.nt.length;t++){const s=V.nt[t];if(s.Z)continue;const n=z[t],o=Math.cos(n.angle)*n.q*.05,i=Math.sin(n.angle)*n.q*.05;s.M.x=o,s.M.y=i}t=z[0].angle,s=z[0].q,function(t,s){const n=document.styleSheets[0],o="shake-animation",i="shake",e=.1*s,h=.75;for(let t=0;t<n.cssRules.length;t++)if(n.cssRules[t].name===o){n.deleteRule(t);break}const a=-Math.cos(t)*e,r=Math.sin(t)*e,c=`\n    @keyframes ${o} {\n      0% { transform: translate(${a}px, ${r}px); }\n      60% { transform: translate(${-.3*a}px, ${-.3*r}px); }\n      100% { transform: translate(0, 0); }\n    }\n  `;n.insertRule(c,n.cssRules.length);let l=-1;for(let t=0;t<n.cssRules.length;t++)if(n.cssRules[t].selectorText===`.${i}`){l=t;break}const u=`\n    .${i} {\n      animation: ${o} ${h}s ease-out;\n    }\n  `;l>=0?(n.deleteRule(l),n.insertRule(u,l)):n.insertRule(u,n.cssRules.length)}(t,s),document.getElementById("canvas-container").classList.add("shake"),setTimeout((()=>{document.getElementById("canvas-container").classList.remove("shake")}),1e3),z.length=0,V.ut=!0,S.inputMode=P.bt,j.style.cursor="not-allowed",document.getElementById("js-hit-ball").classList.add("disabled"),document.getElementById("js-place-wall").classList.add("disabled"),S.Tt.classList.add("disabled"),S.Ht.classList.add("disabled");var t,s;const n=document.getElementById("js-reset");n.classList.remove("disabled"),Array.from(document.getElementsByClassName("button")).forEach((t=>{"js-reset"!==t.id&&(t.style.backgroundColor=null,t.style.boxShadow=null)})),n.style.backgroundColor=V.rt,n.style.boxShadow=`0 5px ${V.ct}`,n.style.color=Ct(...mt(V.rt)),S.It.style.transform=null,S.Et=S.At}():S.inputMode&P.Bt?function(){if(0===U.k.length)return;if(tt(U.k[0].x,U.k[0].y,R.Ot.x,R.Ot.y)<E&&1===U.k.length)return;if(U.k.push({x:R.Ot.x,y:R.Ot.y}),U.k.length<2)return;V.ot.push(new e(U.k[0].x,U.k[0].y,U.k[1].x,U.k[1].y,!0)),U=new a}():(S.inputMode===P.Mt||S.inputMode===P.Ct)&&(S.inputMode=S.yt,S.kt=null,S.gt=null);S.Pt.innerHTML=S.jt}),(function(){S.inputMode===P.ut?function(){if(0===z.length)return;let t=1;for(let s=0;s<z.length;s++){const n=z[s],o=V.nt[s];if(o.Z)continue;t=o._;const i=t+K(R),e=tt(R.Wt.x,R.Wt.y,R.Vt.x,R.Vt.y);n.angle=i,n.q=e}const s=z[0];S.At=`${(180*s.angle/Math.PI).toFixed(0)}° | ${s.q.toFixed(0)}`;let n="";S.Et.length>0&&(n=`<div class="prev-ui-text">${S.Et}</div>`);n+=`<div>${S.At}</div>`,S.Pt.innerHTML=n,function(t,s){const n=-Math.cos(s)*t*.1,o=Math.sin(s)*t*.1;S.It.style.transform=`translate(${n}px, ${o}px)`}(s.q,s.angle)}():S.inputMode===P.Mt?function(){S.gt&&(S.gt===S.kt.t?S.kt.v(R.Ot.x,R.Ot.y,S.kt.o.x,S.kt.o.y):S.kt.v(S.kt.t.x,S.kt.t.y,R.Ot.x,R.Ot.y));G(S.kt)}():S.inputMode===P.Ct?function(){if(S.kt){const t=R.Ot.x-S.Dt.x,s=R.Ot.y-S.Dt.y;S.kt.v(S.kt.t.x+t,S.kt.t.y+s,S.kt.o.x+t,S.kt.o.y+s),S.Dt.x=R.Ot.x,S.Dt.y=R.Ot.y}G(S.kt)}():S.inputMode===P.wt&&U.k.length>0&&G(U)}));let U=new a;function G(t){if(1===t.k.length){const s=R.Ot.x-t.k[0].x,n=R.Ot.y-t.k[0].y,o=(180*Math.atan2(n,s)/Math.PI+360)%360;S.Pt.innerText=`${o.toFixed(0)}°`,-0===o&&(S.Pt.innerText="0")}else{const s=t.k[1].x-t.k[0].x,n=t.k[1].y-t.k[0].y,o=(180*Math.atan2(n,s)/Math.PI+360)%360;S.Pt.innerText=`${o.toFixed(0)}°`,-0===o&&(S.Pt.innerText="0")}}function K(t){return Math.atan2(-(t.Wt.y-t.Vt.y),-(t.Wt.x-t.Vt.x))}function X(t){t.u.x+t.X<0&&(t.u.x=j.width-t.X),t.u.x-t.X>j.width&&(t.u.x=t.X),t.u.y+t.X<0&&(t.u.y=j.height-t.X),t.u.y-t.X>j.height&&(t.u.y=t.X)}function Y(t,s){const n=t.u.x-s.u.x,o=t.u.y-s.u.y;return Math.sqrt(n*n+o*o)<t.X+s.X}function Z(t,s){const n=t.u.x-s.u.x,o=t.u.y-s.u.y,i=Math.sqrt(n*n+o*o);if(i>t.X+s.X)return 0;const e=t.X+s.X;return(e-i)/e}function _(t,s){const n=s.u.x-t.u.x,o=s.u.y-t.u.y,i=Math.sqrt(n*n+o*o);if(0===i)return;const e=t.X+s.X-i,h=n/i,a=o/i;e>0&&(t.u.x-=e*h*(s.K/(t.K+s.K)),t.u.y-=e*a*(s.K/(t.K+s.K)),s.u.x+=e*h*(t.K/(t.K+s.K)),s.u.y+=e*a*(t.K/(t.K+s.K)));const r=(s.M.x-t.M.x)*h+(s.M.y-t.M.y)*a;if(r>0)return;const c=-2*r/(1/t.K+1/s.K);t.M.x-=c/t.K*h,t.M.y-=c/t.K*a,s.M.x+=c/s.K*h,s.M.y+=c/s.K*a}function tt(t,s,n,o){return Math.sqrt(Math.pow(n-t,2)+Math.pow(o-s,2))}function st(t){t.u.x-t.X<0&&nt(t,t.u.x+j.width,t.u.y),t.u.x+t.X>j.width&&nt(t,t.u.x-j.width,t.u.y),t.u.y-t.X<0&&nt(t,t.u.x,t.u.y+j.height),t.u.y+t.X>j.height&&nt(t,t.u.x,t.u.y-j.height),nt(t,t.u.x,t.u.y)}function nt(t,s,n){D.beginPath(),D.arc(s,n,t.X,0,2*Math.PI),D.fillStyle=`rgba(255, 255, 255, ${t.alpha})`,D.strokeStyle=`rgba(0, 0, 0, ${t.alpha})`,D.lineWidth=5,D.setLineDash([]),D.closePath(),D.stroke(),D.fill()}function ot(t){D.beginPath(),D.arc(t.u.x,t.u.y,t.X,0,2*Math.PI),D.fillStyle=t.color,D.fill(),D.closePath()}function it(t){S.It.style.backgroundColor=t.backgroundColor,S.St.style.color=t.ht,S.St.innerText=`${J+1}`,D.clearRect(0,0,j.width,j.height);for(let s=0;s<t.it.length;s++){ot(t.it[s])}for(let s=0;s<t.ot.length;s++){t.ot[s].draw(D)}S.inputMode&P.Bt&&U.k.length>0&&(T.v(U.k[0].x,U.k[0].y,R.Ot.x,R.Ot.y),T.wt=S.inputMode===P.wt,T.draw(D));for(let s=0;s<t.nt.length;s++){st(t.nt[s])}}function et(){D.clearRect(0,0,j.width,j.height),V.dt&&(it(W),D.save(),D.beginPath(),D.arc(j.width/2,j.height/2,q,0,2*Math.PI),D.closePath(),D.clip()),it(V),V.dt&&D.restore();for(let t=0;t<z.length;t++){const s=z[t];V.nt[t].Z||ht(s)}if(D.fillStyle="white",S.inputMode&P.vt){let t;S.inputMode&P.Mt?t=S.kt:S.inputMode&P.Bt&&(t=U),S.inputMode===P.wt&&t&&t.k.length}}function ht(t){at(D,t.O.x,t.O.y,t.U.x,t.U.y);const s=Math.abs(t.O.x-t.U.x),n=Math.abs(t.O.y-t.U.y);let o=t.O.x,i=t.U.x,e=t.O.y,h=t.U.y;t.U.x<0&&(o=t.O.x+j.width,i=o-s),t.U.x>j.width&&(o=t.O.x-j.width,i=o+s),t.U.y<0&&(e=t.O.y+j.height,h=e-n),t.U.y>j.height&&(e=t.O.y-j.height,h=e+n),at(D,o,e,i,h)}function at(t,s,n,o,i){const e=tt(s,n,o,i);var h=Math.min(e,20),a=Math.atan2(i-n,o-s);t.fillStyle="#fff",t.strokeStyle="#000",t.lineWidth=5,t.beginPath(),t.moveTo(s,n),t.lineTo(o-h/2*Math.cos(a),i-h/2*Math.sin(a)),t.stroke(),t.strokeStyle="#fff",t.fillStyle="#fff",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(o,i),t.lineTo(o-h*Math.cos(a-Math.PI/6),i-h*Math.sin(a-Math.PI/6)),t.lineTo(o-h*Math.cos(a+Math.PI/6),i-h*Math.sin(a+Math.PI/6)),t.closePath(),t.fill(),t.lineWidth=3,t.strokeStyle="#000",t.stroke(),t.fillStyle="#fff",t.fill(),t.beginPath(),t.moveTo(s,n),t.lineTo(o-h/2*Math.cos(a),i-h/2*Math.sin(a)),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.fillStyle="#fff",t.beginPath(),t.arc(s,n,5,0,2*Math.PI),t.fill(),t.closePath()}function rt(t){V.update();for(let s=0;s<V.nt.length;s++){const n=V.nt[s],o=z[s];n.update(t);for(let t=0;t<V.nt.length;t++){if(s===t)continue;const o=V.nt[t];n.Z||o.Z||n.alpha<.5||Y(n,o)&&_(n,o)}o&&(o.O.x=n.u.x,o.O.y=n.u.y),S.inputMode===P.bt&&(X(n),dt(n),ct(n))}if(V.dt&&(q-=Q,q<=0&&lt(J+2)),V.ut)for(let t=0;t<V.nt.length;t++){const s=V.nt[t];s.Z||(null===S.$t&&(S.$t=Date.now()),tt(s.M.x,s.M.y,0,0)<A?null===S.$t&&(S.$t=Date.now()):S.$t=null,null!==S.$t&&Date.now()-S.$t>1e3&&(xt(),ut()))}for(let t=0;t<V.ot.length;t++){const s=V.ot[t];s.C&&s.update()}}function ct(t){for(let s=0;s<V.ot.length;s++){const n=V.ot[s];if(n.C)continue;const o=l(t,n);if(o){const s=.5*Math.hypot(t.M.x,t.M.y);n.P(s),Bt(Math.random()*Math.PI*2),t.u.x+=o.G.x,t.u.y+=o.G.y;const i=o.axis,e=t.M.x*i.x+t.M.y*i.y;t.M.x-=2*e*i.x,t.M.y-=2*e*i.y}}}function lt(t){J=(t-1)%N.length;const s=(J+1)%N.length;V=N[J],W=N[s],q=O,V.reset(),location.hash=`#/${J+1}`,S.Et="",ut(),xt()}function ut(){document.getElementById("js-hit-ball").classList.add("active"),document.getElementById("js-place-wall").classList.remove("active"),document.getElementById("js-reset").classList.remove("active"),document.getElementById("js-hit-ball").classList.remove("disabled"),document.getElementById("js-place-wall").classList.remove("disabled");document.getElementById("js-reset").classList.add("disabled"),S.Ht.classList.remove("disabled"),S.Tt.classList.remove("disabled"),0===J&&S.Ht.classList.add("disabled"),J===N.length-1&&S.Tt.classList.add("disabled"),Array.from(document.getElementsByClassName("button")).forEach((t=>{let s=V.rt,n=`0 5px ${V.ct}`,o=Ct(...mt(V.rt));t.classList.contains("disabled")?(t.style.backgroundColor=null,t.style.boxShadow=null,t.style.color=null):(t.style.backgroundColor=s,t.style.boxShadow=n,t.style.color=o)})),S.$t=null,S.kt=null,S.gt=null,S.inputMode=P.ut,j.style.cursor="crosshair"}function dt(t){t.st=!1;for(let s=0;s<V.it.length;s++){const n=V.it[s],o=n.u.x-t.u.x,i=n.u.y-t.u.y,e=Math.sqrt(o*o+i*i),h=Math.sqrt(t.M.x*t.M.x+t.M.y*t.M.y);if(e<=n.X-t.X&&h<F)t.Z=n,t.st=!0;else if(Y(t,n)){const s=.2*Z(t,n),h=s*o/e,a=s*i/e;t.M.x+=h,t.M.y+=a,t.alpha-=.01,t.alpha=Math.max(t.alpha,0),t.st=!0}}t.st||(t.alpha=1)}const ft=1e3/60;let wt=0,Mt=0;function pt(){const t=window.location.hash.substring(2);return 0===t.length?1:parseInt(t,10)}function mt(t){var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]:null}function Ct(t,s,n){const o=function(t,s,n){return.299*t+.587*s+.114*n}(t,s,n);return o>128?"black":"white"}function xt(){S.At="",S.jt=`${J+1} / ${N.length}`,S.Pt.innerHTML=S.jt,S.Pt.style.color=Ct(...mt(V.rt)),S.Pt.style.backgroundColor=V.rt,V.reset()}function Bt(t){!function(t){const s=document.styleSheets[0],n="shake-animation",o="shake";for(let t=0;t<s.cssRules.length;t++)if(s.cssRules[t].name===n){s.deleteRule(t);break}const i=1*Math.cos(t),e=1*-Math.sin(t);let h=`\n    @keyframes ${n} {\n      0% { transform: translate(0, 0); }\n      10% { transform: translate(${-10*i}px, ${10*e}px); }\n      20% { transform: translate(${10*i}px, ${-10*e}px); }\n      30% { transform: translate(${-8*i}px, ${8*e}px); }\n      40% { transform: translate(${8*i}px, ${-8*e}px); }\n      50% { transform: translate(${-5*i}px, ${5*e}px); }\n      60% { transform: translate(${5*i}px, ${-5*e}px); }\n      70% { transform: translate(${-3*i}px, ${3*e}px); }\n      80% { transform: translate(${3*i}px, ${-3*e}px); }\n      90% { transform: translate(${-1*i}px, ${e}px); }\n      100% { transform: translate(0, 0); }\n    }\n  `;s.insertRule(h,s.cssRules.length);let a=-1;for(let t=0;t<s.cssRules.length;t++)if(s.cssRules[t].selectorText===`.${o}`){a=t;break}const r=`\n    .${o} {\n      animation: ${n} 1s ease-out;\n    }\n  `;a>=0?(s.deleteRule(a),s.insertRule(r,a)):s.insertRule(r,s.cssRules.length)}(t),document.getElementById("canvas-container").classList.add("shake"),setTimeout((()=>{document.getElementById("canvas-container").classList.remove("shake")}),1e3)}!function t(s){const n=s-Mt;for(Mt=s,wt+=n;wt>=ft;)rt(ft),wt-=ft;et(),requestAnimationFrame(t)}(0),document.addEventListener("DOMContentLoaded",(()=>{lt(pt()),I()})),window.addEventListener("hashchange",(()=>{lt(pt())})),document.body.addEventListener("click",(()=>{S.title.style.opacity=0})),window.addEventListener("mousemove",(t=>{const s=j.getBoundingClientRect();let n="crosshair";for(let o=0;o<V.ot.length;o++){let i=t.clientX-s.left,e=t.clientY-s.top;const h=V.ot[o];i/=H(),e/=H(),h.V(i,e)?n="pointer":(h.N(i,e)||h.H(i,e))&&(n="grab")}S.inputMode===P.bt&&(n="not-allowed"),j.style.cursor=n}))})();